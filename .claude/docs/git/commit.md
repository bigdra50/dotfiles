# Git Commit ガイド

## コミットメッセージ作成方針

### 基本原則

1. **gitmoji prefix使用** (GitHub shortcode形式)
2. **日本語でのメッセージ作成**
3. **簡潔で明確な説明**
4. **「なぜ」に焦点を当てる**

### gitmoji 一覧

| gitmoji            | 用途                 | 例                                              |
| ------------------ | -------------------- | ----------------------------------------------- |
| :sparkles:         | 新機能               | `:sparkles: ユーザー認証機能を追加`             |
| :bug:              | バグ修正             | `:bug: ログイン時の無限ループを修正`            |
| :memo:             | ドキュメント更新     | `:memo: API仕様書を更新`                        |
| :recycle:          | リファクタリング     | `:recycle: ユーザー管理ロジックを整理`          |
| :zap:              | パフォーマンス改善   | `:zap: データベースクエリを最適化`              |
| :art:              | コード構造・形式改善 | `:art: インデントを統一`                        |
| :wrench:           | 設定ファイル変更     | `:wrench: ESLint設定を追加`                     |
| :white_check_mark: | テスト追加・更新     | `:white_check_mark: ユーザー登録のテストを追加` |
| :rocket:           | デプロイ・リリース   | `:rocket: バージョン1.2.0をリリース`            |
| :lock:             | セキュリティ修正     | `:lock: SQLインジェクション脆弱性を修正`        |

### コミットメッセージの構造

```
:gitmoji: 簡潔なタイトル（50文字以内）

詳細説明（必要な場合のみ）
- 変更の背景・理由
- 影響範囲
- 注意事項
```

### 良い例・悪い例

#### 良い例

```bash
git commit -m ":sparkles: JWT認証を導入

- セッション管理をよりセキュアに
- パスワードレス認証への布石
- 既存のログイン機能は互換性保持"
```

#### 悪い例

```bash
git commit -m "修正"  # 何を修正したか不明
git commit -m "WIP"   # 一時的すぎる
git commit -m "バグ直した" # gitmojiなし、詳細不明
```

## What / Why / How フレームワーク

### コミットメッセージの情報分担

コミットメッセージには**コミット時点で確定している情報**のみを記録します：

| 要素 | 内容 | 例 |
|------|------|-----|
| **What** | 何を変更したか | `JWT認証機能を追加` |
| **Why** | なぜ変更したか | `セキュリティ強化のため` |
| **How** | どのように実装したか | `express-jwt ミドルウェアを使用` |

### 詳細ガイド

#### What（何を）- タイトル部分
```bash
# ✅ 良い例: 具体的で明確
:sparkles: JWT認証機能を追加
:bug: ログイン時のメモリリークを修正
:recycle: ユーザー管理APIを整理

# ❌ 悪い例: 曖昧・不明確
:sparkles: 機能追加
:bug: バグ修正
:recycle: リファクタリング
```

#### Why（なぜ）- 本文1行目
```bash
# ✅ 良い例: 変更の目的・背景
- セキュリティ要件強化のため
- パフォーマンス改善のため
- 既存バグ解決のため
- 将来の機能拡張への布石

# ❌ 悪い例: 目的不明
- 指示されたので
- 古いコードだったので
- なんとなく
```

#### How（どのように）- 本文詳細
```bash
# ✅ 良い例: 実装手法・技術選択
- express-jwt ライブラリを導入
- bcrypt でパスワードハッシュ化
- Redis でセッション管理
- 既存APIとの互換性保持

# ❌ 悪い例: 実装詳細不明
- いい感じに実装
- 適当に修正
- よくある方法で対応
```

### コミットメッセージテンプレート

```bash
# 基本形式
:gitmoji: [What] 簡潔なタイトル（50文字以内）

[Why] 変更の目的・背景
[How] 実装方法・技術選択
- 詳細1
- 詳細2
- 注意事項
```

### 実践例

#### 例1: 新機能追加
```bash
git commit -m "$(cat <<'EOF'
:sparkles: JWT認証機能を追加

セキュリティ要件強化とスケーラビリティ向上のため
- jsonwebtoken ライブラリでトークン生成・検証
- リフレッシュトークン機能付き
- 既存セッション認証との並行稼働
- httpOnly Cookie でセキュアな保存
EOF
)"
```

#### 例2: バグ修正
```bash
git commit -m "$(cat <<'EOF'
:bug: ログイン時のメモリリークを修正

大量ログイン時のサーバー不安定化を解決するため
- イベントリスナーの適切な削除処理追加
- WeakMap使用でガベージコレクション改善
- ログイン後の不要オブジェクト参照削除
EOF
)"
```

#### 例3: リファクタリング
```bash
git commit -m "$(cat <<'EOF'
:recycle: ユーザー管理ロジックを整理

コード可読性向上と将来の機能拡張準備のため
- ユーザー操作を UserService クラスに集約
- バリデーション処理を分離
- 責務を明確に分担（SRP準拠）
- 既存の外部API仕様は変更なし
EOF
)"
```

### コミットに含めるべき情報・含めるべきでない情報

#### ✅ 含めるべき情報（コミット時点で確定）
- **変更の内容**: 何を変更したか
- **変更の理由**: なぜ必要だったか
- **実装手法**: どのような技術・アプローチか
- **影響範囲**: 既存機能への影響
- **前提条件**: 動作に必要な環境・設定

#### ❌ 含めるべきでない情報（後から判明）
- **レビュー結果**: コードレビューの評価
- **テスト結果**: CI/CDの実行結果
- **デプロイ状況**: 本番環境での動作
- **パフォーマンス実測**: 実際の性能影響
- **ユーザー反応**: 運用後のフィードバック

```bash
# ❌ 悪い例: 後から判明することを含む
git commit -m ":sparkles: 認証機能追加（レビュー通過、本番デプロイ済み）"

# ✅ 良い例: コミット時点の情報のみ
git commit -m ":sparkles: JWT認証機能を追加

セキュリティ強化のため
- jsonwebtoken使用
- 既存機能との互換性保持"
```

### ワークフロー

1. **変更内容の確認**

   ```bash
   git status
   git diff --staged
   ```

2. **What/Why/Howを整理**

   - What: 何を変更したか明確化
   - Why: なぜこの変更が必要か確認
   - How: どのような手法で実装したか整理

3. **gitmojiとメッセージ作成**

   - 変更の性質に応じたgitmoji選択
   - テンプレートに従って構造化

4. **コミット実行**

   ```bash
   git commit -m "$(cat <<'EOF'
   :gitmoji: [What]
   
   [Why]
   [How]
   - 詳細
   EOF
   )"
   ```

### コミット粒度の指針

#### 適切な粒度

- **1つの論理的変更** = 1つのコミット
- **独立してレビュー可能**
- **ビルドが通る状態**

#### 分割すべき例

```bash
# 悪い例: 複数の変更を1つに
git commit -m ":sparkles: 認証機能追加とバグ修正とドキュメント更新"

# 良い例: 適切に分割
git commit -m ":sparkles: ユーザー認証機能を追加"
git commit -m ":bug: ログイン画面の表示崩れを修正"
git commit -m ":memo: 認証APIのドキュメントを追加"
```

### 関連リンク

- [Conventional Commits](https://conventionalcommits.org/)
- [gitmoji Guide](https://gitmoji.dev/)
- [Git Best Practices](https://github.com/trein/dev-best-practices/wiki/Git-Commit-Best-Practices)

