# エラーハンドリング

## サブタスク失敗時

```
[エラー検知] Subtask X.Y が失敗
  エラー内容: ...

[判断]
  - 他の並列タスクへの影響: あり / なし
  - リトライ可能: はい / いいえ
  - 代替手段: あり / なし

[対応]
  選択肢A: リトライ（最大2回）
  選択肢B: スキップして続行
  選択肢C: ユーザー確認を要求
  選択肢D: 全体を中断

  → 選択: [X]、理由: ...
```

## 対応選択のガイドライン

| 状況 | 推奨対応 |
|------|----------|
| 一時的エラー（ネットワーク等） | リトライ |
| オプショナルなタスク | スキップして続行 |
| クリティカルなタスク | ユーザー確認 |
| 回復不能なエラー | 全体を中断 |

## 部分成功時

```
[部分成功] Step N: 3/5 サブタスク成功

[評価]
  - 失敗タスク: X.2, X.4
  - 失敗理由: ...
  - 次ステップへの影響: 軽微 / 重大

[判断]
  → 続行 / 中断 / ユーザー確認
  理由: ...
```

## 部分成功の判断基準

**続行可能:**
- 失敗タスクが次ステップに必須でない
- 代替データや部分結果で進行可能
- 失敗率が低い（例: 4/5成功）

**ユーザー確認が必要:**
- 失敗タスクが重要だが代替手段あり
- 進行方針の判断が必要
- 失敗率が中程度（例: 3/5成功）

**中断すべき:**
- 失敗タスクが後続全てに必須
- 失敗率が高い（例: 1/5成功）
- データ整合性に問題が生じる

## エラーログ形式

```
=== エラー発生 ===
ステップ: Step N
サブタスク: X.Y
エラー種別: [タイムアウト/権限エラー/データ不整合/...]
詳細: ...
影響範囲: [このステップのみ/後続ステップ/全体]
対応: [選択した対応と理由]
```

## 回復パターン

### パターン1: リトライで回復
```
[Subtask 2.1 失敗] タイムアウト
[リトライ 1/2] 実行中...
[Subtask 2.1 成功] 回復完了
```

### パターン2: 代替手段で続行
```
[Subtask 3.2 失敗] API制限
[代替] ローカルキャッシュを使用
[続行] 次ステップへ（精度低下の可能性を注記）
```

### パターン3: ユーザー判断で解決
```
[Subtask 4.1 失敗] 権限不足
[確認] 「管理者権限が必要です。スキップして続行しますか？」
[ユーザー応答] 「続行」
[続行] Step 5へ
```
