# レガシーコード改善チェックリスト

## フェーズ1: 現状把握

### インフラ確認

- [ ] バージョン管理（git）が導入されているか
- [ ] CIパイプラインがあるか
- [ ] デプロイが自動化されているか
- [ ] 開発環境のセットアップ手順があるか

### コード確認

- [ ] テストコードの有無と網羅率
- [ ] 主要なエントリーポイントの特定
- [ ] 外部依存（API、DB、ファイル）の把握
- [ ] ランダム性・時刻依存の箇所
- [ ] グローバル状態の有無

### ドキュメント確認

- [ ] 仕様書の有無
- [ ] API定義の有無
- [ ] コメントの質と量

---

## フェーズ2: 基盤整備

### バージョン管理（最優先）

- [ ] `git init`
- [ ] `.gitignore`の設定
- [ ] 初回コミット（現状を保存）

### 最初のテスト

- [ ] テストフレームワークの導入
- [ ] 最も簡単なテストを1つ書く
- [ ] テストが実行できることを確認

### 自動化

- [ ] `npm test` / `pytest` 等のコマンド整備
- [ ] CI設定ファイルの作成

---

## フェーズ3: 改善実行

### 接合部（Seam）の作成

- [ ] ランダム性を引数で渡せるように
- [ ] 時刻依存を引数で渡せるように
- [ ] 外部API呼び出しをモック可能に
- [ ] ファイルI/Oを抽象化

### テスト追加

- [ ] 特性化テスト（現状の動作を記録）
- [ ] 境界値テスト
- [ ] エラーケースのテスト
- [ ] 正常系のテスト

### リファクタリング

- [ ] 長いメソッドの分割
- [ ] 重複コードの統合
- [ ] 命名の改善
- [ ] マジックナンバーの定数化

---

## フェーズ4: アーキテクチャ改善

### モデル分離

- [ ] ドメインロジックの特定
- [ ] Plain Oldオブジェクトへの抽出
- [ ] フレームワーク層の薄型化

### 依存関係の整理

- [ ] 依存の方向を確認（内→外）
- [ ] 循環依存の解消
- [ ] インターフェースによる分離

---

## 危険信号チェック

以下があれば要注意：

| 信号 | 対応 |
|------|------|
| グローバル変数 | 引数渡しに変更 |
| 巨大な関数（100行超） | 責務で分割 |
| 深いネスト（4階層超） | 早期リターンで平坦化 |
| God Class | 単一責任に分割 |
| コメントアウトされたコード | 削除（gitにある） |

---

## 改善の原則

1. **小さく始める** - 1つのテストから
2. **頻繁にコミット** - 動く状態を保存
3. **テストを先に** - 変更前にテストで保護
4. **リスクを分散** - 一度に大きく変えない
5. **完璧を求めない** - 少しずつ良くする
