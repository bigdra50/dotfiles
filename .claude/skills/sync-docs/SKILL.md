---
name: sync-docs
description: |
  ドキュメントと実装コードを照合し、古い記述・誤りを特定して修正する。
  Use for: "ドキュメント検証", "docs同期", "実装と照合", "ドキュメント更新", "sync-docs"
user-invocable: true
---

# Documentation Sync

ドキュメント（docs/）を実装コードと照合し、乖離を検出・修正する。

## Usage

```
/sync-docs [target]
```

- `target`: 対象ディレクトリ（省略時: docs/）

## Workflow

### Phase 1: 対象特定

```bash
find <target> -name "*.md" -type f
```

ドキュメント数に応じてバッチサイズを決定:
- ~10ファイル: 1バッチ
- 11-30ファイル: カテゴリ別に2-4バッチ
- 30+ファイル: サブディレクトリ単位でバッチ

### Phase 2: 並列検証

各バッチをExplore agentで並列検証:

```
Task(subagent_type="Explore", prompt="""
タスク: <対象ドキュメント> を実装と照合

検証項目:
1. クラス名・メソッド名・インターフェース名が実装に存在するか
2. コード例が現在の実装パターンと一致するか
3. 数値・設定値（タイムアウト、閾値等）が実装と一致するか
4. ファイルパス・ディレクトリ構造が正確か
5. 記載機能が実際に実装されているか

期待出力:
[検証レポート]
ファイル: xxx.md
問題点: (箇条書き or "なし")
修正提案: (あれば具体的に)
""")
```

### Phase 3: 結果集約

検証結果を重大度で分類:

| 重大度 | 基準 |
|--------|------|
| 高 | 実装が存在しない、シグネチャ不一致、数値誤り |
| 中 | パス誤り、命名不一致、説明が古い |
| 低 | typo、表現の改善 |

### Phase 4: ユーザー確認

修正前に確認:

1. **未実装機能の扱い**
   - ドキュメントから削除
   - 「未実装」と明記して残す
   - 個別判断

2. **修正範囲**
   - 重大度「高」のみ
   - 全て修正
   - 特定カテゴリのみ

### Phase 5: 修正適用

general-purpose agent で並列修正:

```
Task(subagent_type="general-purpose", prompt="""
タスク: <対象ファイル> を修正

修正内容:
- <具体的な修正リスト>

各ファイルを読み込み、修正を適用してください。
""")
```

### Phase 6: 最終レポート

```
検証対象: N ファイル
修正済み: M ファイル
削除: K ファイル

[カテゴリ別の修正サマリ表]
```

## 検証チェックリスト

### コード例

- [ ] クラス名が実装に存在
- [ ] メソッドシグネチャが一致
- [ ] 引数名・型が一致
- [ ] 戻り値の型が一致

### 設定値

- [ ] タイムアウト値
- [ ] 閾値・定数
- [ ] デフォルト値
- [ ] 列挙型の値

### 構造

- [ ] ファイルパス
- [ ] ディレクトリ構造
- [ ] アセンブリ名
- [ ] 名前空間

### 機能

- [ ] 記載機能が実装されている
- [ ] 削除された機能が残っていない
- [ ] 新機能が記載されている

## Tips

- アーキテクチャドキュメントは実装パターンの変更で陳腐化しやすい
- 数値（タイムアウト、半径等）は実装のconst/設定ファイルと照合
- 未実装機能は仕様書から転記されたまま残りやすい
