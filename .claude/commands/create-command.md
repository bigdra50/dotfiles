# 新しいスラッシュコマンドをベストプラクティスに従って作成する

自然言語の入力から、ベストプラクティスに準拠した高品質なスラッシュコマンドを自動生成します。

## ワークフロー:

1. **入力解析と意図理解**
   - $ARGUMENTS から自然言語記述とファイルパスを分離
   - 自然言語の意図解析（動詞、対象、修飾語の抽出）
   - 参照ファイルの存在確認とアクセス権チェック

2. **外部ドキュメント解析（該当する場合）**
   - 指定されたファイル/ディレクトリの内容読み込み
   - ドキュメントタイプの判定と構造解析
   - 重要情報の抽出と知見の整理

3. **コマンド設計の自動推定**
   - 意図とドキュメント内容からテンプレートタイプを選択
   - 動詞と対象からコマンド名を自動生成
   - 既存コマンドとの重複チェック

4. **対話による詳細設計**
   - 推定した内容をユーザーに提示
   - 不足している情報の補完収集
   - エラーケースと制約の確認

5. **テンプレート生成とカスタマイズ**
   - 選択されたテンプレートに解析結果を適用
   - ベストプラクティスの自動組み込み
   - 外部ドキュメントの知見を反映

6. **ファイル作成とプレビュー**
   - 生成されたコマンドファイルのプレビュー表示
   - ユーザー確認と修正機会の提供
   - ファイル作成実行とフィードバック表示

## 自然言語解析ロジック:

### 入力パターン検出
- **ファイルパス検出**: `path/to/file.md`, `./docs/*.md`, `src/**/*.ts` パターン
- **動作記述検出**: "〜するコマンド", "〜を作って", "〜するやつ"パターン
- **複合パターン**: ファイル参照 + 動作記述の組み合わせ

### 意図抽出アルゴリズム
以下のキーワードパターンで動詞と対象を抽出:

**動詞マッピング:**
- 作る、作成、生成 → create, generate
- 送る、送信、投稿 → send, post
- 更新、変更、修正 → update, fix
- 確認、チェック、検証 → check, validate
- 実行、やる、処理 → execute, run
- デプロイ、配布 → deploy
- ビルド、構築 → build
- テスト、試験 → test

**対象マッピング:**
- コミット、プッシュ → commit, push
- ドキュメント、資料 → docs, documentation
- 設定、コンフィグ → config, settings
- タスク、作業 → tasks, work
- 進捗、状況 → progress, status
- ファイル、データ → files, data
- プロジェクト → project
- API → api

**修飾語処理:**
- まとめて、一括 → batch
- 自動、オート → auto
- 毎日、定期 → daily, scheduled
- 高速、クイック → quick, fast

### テンプレートタイプ自動選択

**Gitテンプレート判定キーワード:**
`git`, `コミット`, `プッシュ`, `ブランチ`, `マージ`, `リポジトリ`, `commit`, `push`, `branch`, `merge`

**プロジェクト管理テンプレート判定キーワード:**
`プロジェクト`, `タスク`, `進捗`, `計画`, `スケジュール`, `project`, `task`, `progress`, `plan`

**ドキュメント生成テンプレート判定キーワード:**
`ドキュメント`, `資料`, `README`, `API仕様`, `docs`, `documentation`, `spec`

**オーケストレーターテンプレート判定キーワード:**
`まとめて`, `一括`, `複数`, `段階`, `フロー`, `batch`, `multiple`, `workflow`, `pipeline`

**基本テンプレート:**
上記に該当しない場合のデフォルト

## コマンド名自動生成アルゴリズム:

1. **基本パターン生成**
   - 動詞-対象パターン: `{verb}-{object}`
   - 修飾語付きパターン: `{modifier}-{verb}-{object}`
   - 例: "batch-commit-push", "auto-generate-docs"

2. **命名規則適用**
   - 全て小文字に変換
   - 単語間をハイフンで区切り
   - 特殊文字の除去
   - 長すぎる場合の短縮（30文字制限）

3. **重複チェックと解決**
   - 既存コマンドファイルとの照合
   - 重複時は数字サフィックスを追加（例: `deploy-app-2`）
   - ユーザーへの代替案提示

## ファイル参照・解析機能:

### 対応ファイル形式
- **Markdown**: `.md` - ドキュメント、手順書、仕様書
- **JSON**: `.json` - 設定ファイル、APIスキーマ
- **YAML**: `.yml`, `.yaml` - 設定ファイル、CI/CD定義
- **TypeScript/JavaScript**: `.ts`, `.js` - コード、API定義
- **Package files**: `package.json`, `Cargo.toml`, `requirements.txt`

### ドキュメント解析パターン

**API仕様書検出:**
- エンドポイント定義の抽出
- パラメータとレスポンス形式の特定
- 認証方式の確認

**手順書検出:**
- 順序のあるステップの抽出
- 前提条件と依存関係の特定
- エラー対処法の確認

**設定ファイル検出:**
- 設定項目の一覧化
- 必須/オプション項目の判別
- デフォルト値の特定

## テンプレートパターン定義:

### 基本テンプレート
```markdown
# {コマンド名}

{目的と概要説明}

## ワークフロー:
1. {メインステップ1}
2. {メインステップ2}
3. {結果確認}

## エラーハンドリング:
- {想定エラー1}
- {想定エラー2}

## 使用例:
`claude /{コマンド名} [引数]`
```

### Gitテンプレート
```markdown
# {コマンド名}

{Git操作の説明}

## ワークフロー:
1. **Git状態確認**
   - `git status` で現在の状態確認
   - 未コミットの変更確認

2. **{メインGit操作}**
   - {具体的なGit操作}
   - 競合やエラーの確認

3. **結果検証**
   - 操作完了の確認
   - 期待される状態との照合

## エラーハンドリング:
- Gitリポジトリでない場合
- 未コミットの変更が存在する場合
- リモートとの競合が発生した場合
- ネットワークエラーが発生した場合

## 使用例:
`claude /{コマンド名} [ブランチ名やコミットメッセージ]`
```

### プロジェクト管理テンプレート
```markdown
# {コマンド名}

{プロジェクト管理機能の説明}

## ワークフロー:
1. **現状確認**
   - プロジェクトファイルの読み込み
   - 現在の進捗状況確認

2. **{メイン処理}**
   - {具体的な管理操作}
   - データの更新や集計

3. **結果出力**
   - 処理結果の表示
   - 必要に応じてファイル更新

## エラーハンドリング:
- プロジェクトファイルが見つからない場合
- データ形式が不正な場合
- 外部サービスとの連携エラー
- 権限エラーが発生した場合

## 使用例:
`claude /{コマンド名} [プロジェクト名やタスク名]`
```

### ドキュメント生成テンプレート
```markdown
# {コマンド名}

{ドキュメント生成の説明}

## ワークフロー:
1. **ソース解析**
   - 対象ファイルの読み込み
   - 構造とパターンの解析

2. **ドキュメント生成**
   - テンプレートの適用
   - 内容の自動生成

3. **出力と確認**
   - 生成ファイルの保存
   - 品質チェックの実行

## エラーハンドリング:
- ソースファイルが見つからない場合
- 解析できない形式の場合
- 出力先への書き込み権限がない場合
- テンプレートエラーが発生した場合

## 使用例:
`claude /{コマンド名} [出力ディレクトリ]`
```

### オーケストレーターテンプレート
```markdown
# {コマンド名}

{複雑なタスクの段階的実行説明}

## プロセス:

1. **初期分析**
   - 全体スコープの理解
   - 依存関係と実行順序の特定

2. **段階的計画**
   - 2-4個の連続ステップに分解
   - 各ステップ内で並列サブタスク定義

3. **段階別実行**
   - 現在ステップのサブタスク並列実行
   - 全サブタスク完了の確認
   - 次ステップへの結果受け渡し

4. **適応的計画調整**
   - 各ステップ完了後の見直し
   - 残りステップの適切性検証
   - 必要に応じた計画修正

## 実行例:
**ステップ1: {分析フェーズ}**
- サブタスク1
- サブタスク2

**ステップ2: {実行フェーズ}**
- サブタスク3
- サブタスク4

**ステップ3: {検証フェーズ}**
- サブタスク5
- サブタスク6

## エラーハンドリング:
- サブタスクの部分失敗時の復旧方法
- ステップ間の依存関係エラー
- 外部リソースアクセスエラー
- 実行時間超過の対処

## 使用例:
`claude /{コマンド名} [全体的なコンテキスト]`
```

## エラーハンドリング:

### 入力検証エラー
- **無効なコマンド名**: 特殊文字、長すぎる、予約語との競合
- **ファイルパスエラー**: 存在しない、アクセス権限なし、対応外形式
- **解析失敗**: 自然言語の意図が不明、テンプレート選択不可

### システムエラー
- **ファイル作成エラー**: 書き込み権限なし、ディスク容量不足
- **既存コマンド重複**: 同名ファイルの存在確認とユーザー確認
- **外部ファイル読み込みエラー**: 大きすぎる、形式不正

### ユーザー操作エラー
- **対話中断**: Ctrl+C等での中断時の適切な終了
- **不正な入力**: 対話中の無効な選択肢、空入力
- **確認拒否**: ユーザーがコマンド作成を取り消した場合

## 使用例:

### カジュアルな表現での作成
```bash
# シンプルな要求
claude /create-command "Git関連をまとめてやるコマンド作って"

# 具体的な説明
claude /create-command "毎朝のタスクチェックを自動化したい"

# 口語的表現
claude /create-command "デプロイするやつが欲しい"
```

### ファイル参照を含む作成
```bash
# 設定ファイル参照
claude /create-command "package.json を見てビルドコマンド作って"

# ドキュメント参照
claude /create-command "docs/api-spec.md を参考にAPI仕様書生成コマンド"

# 複数ファイル参照
claude /create-command "src/**/*.ts を解析してドキュメント生成"
```

### 詳細指定での作成
```bash
# 特定の技術スタック
claude /create-command "Next.js プロジェクトのデプロイ自動化コマンド"

# 複雑なワークフロー
claude /create-command "テスト実行→ビルド→デプロイを一括でやるコマンド"
```

### 対話型での作成
```bash
# 引数なしで詳細な対話
claude /create-command
```

$ARGUMENTS が提供された場合、自然言語解析を実行してコマンドを生成します。引数がない場合は対話型モードで詳細な情報収集を行います。