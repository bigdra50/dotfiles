# refactor-net-lib

.NETのクラスライブラリ設計原則に準拠したリファクタリングを段階的に実行する

## 概要

既存のコードベースを「.NETのクラスライブラリ設計」で推奨される構造とパターンに合わせて段階的にリファクタリングします。Core/Implementation/Extensions/Configuration の4層構造への変換、Interface-First設計の適用、.NET標準命名規則への準拠を自動化します。

## プロセス:

### 1. **構造分析フェーズ**
   - 現在のディレクトリ構造とファイル配置の分析
   - 名前空間とクラス名の命名パターン調査
   - 依存関係と抽象化レベルの評価
   - .NET設計原則との差異識別

### 2. **設計計画フェーズ**
   - .NET標準4層構造（Core/Implementation/Extensions/Configuration）への変換計画策定
   - インターフェース抽出とInterface-First設計への移行計画
   - 命名規則統一計画（PascalCase、名前空間対応等）
   - 段階的移行のリスク評価

### 3. **構造リファクタリング実行**
   - **Core/** - インターフェース・抽象化・ドメインモデルの分離
   - **Implementation/** - 具象実装クラスの整理と階層化
   - **Extensions/** - ファクトリパターン・拡張メソッドの分離
   - **Configuration/** - 設定・オプション管理の統合

### 4. **命名・名前空間標準化**
   - .NET命名規則への統一（PascalCase、camelCase、接頭辞等）
   - 名前空間とフォルダ構造の対応確保
   - using文の整理と依存関係の明示
   - 技術用語の標準化（Communication→Networking等）

### 5. **設計パターン適用**
   - Interface-First設計への移行
   - Dependency Injection対応の実装
   - Factory Patternの適用
   - 不変データ構造の導入

### 6. **検証・最適化**
   - .NET設計原則への準拠度チェック
   - コンパイルエラーの解決
   - 依存関係の循環参照検出
   - パフォーマンス影響の評価

## 適用される.NET設計原則:

### **シンプルさの原則**
- 最小限の概念でAPI設計
- 複雑な階層構造や過度な抽象化を回避
- 明確な責任分離

### **一貫性の原則**
- 名前空間とフォルダ構造の一致
- 機能ごとの明確な分離
- 統一された命名規則

### **進化可能性の原則**
- 将来の拡張を考慮した設計
- 実装の詳細をAPIに露出させない
- インターフェースによる抽象化

## リファクタリング例:

### Before (典型的な問題)
```
MyLibrary/
├── Services/           # 混在した責務
├── Utils/              # 曖昧な分類
├── Models/             # ドメインと実装の混在
└── Helpers/            # 不明確な役割
```

### After (.NET標準準拠)
```
MyLibrary/
├── Core/              # インターフェース・抽象化
├── Implementation/    # 具象実装
├── Configuration/     # 設定・オプション
└── Extensions/        # ファクトリ・拡張メソッド
```

## エラーハンドリング:

### 構造分析エラー
- **ファイル読み込み失敗**: 権限不足、破損ファイル
- **依存関係解析失敗**: 循環参照、未解決依存
- **名前空間パース失敗**: 構文エラー、非標準パターン

### リファクタリング実行エラー
- **ファイル移動失敗**: 書き込み権限不足、ファイルロック
- **名前空間変更失敗**: 参照の更新失敗、コンパイルエラー
- **コード生成失敗**: テンプレート適用エラー、文法エラー

### 検証エラー
- **循環依存の発生**: リファクタリング後の不正な依存関係
- **コンパイルエラー**: 参照解決失敗、型不一致
- **実行時エラー**: 動的な依存関係の破綻

## 使用例:

### 基本的な使用方法
```bash
# 現在のディレクトリをリファクタリング
claude /refactor-net-lib

# 特定のライブラリプロジェクトを指定
claude /refactor-net-lib path/to/MyLibrary

# 段階的実行（確認を含む）
claude /refactor-net-lib --interactive path/to/project
```

### 実行時の対話例
```
📋 構造分析完了: 
   - 3つのディレクトリが.NET標準に非準拠
   - 8つのクラスでInterface-First設計が必要
   - 15個の名前空間で命名規則統一が必要

🎯 リファクタリング計画:
   ステップ1: Core/Implementation分離 (5ファイル移動)
   ステップ2: インターフェース抽出 (3クラス)
   ステップ3: 名前空間統一 (15ファイル更新)

継続しますか？ (y/N): 
```

## 注意事項:

- **バックアップ推奨**: 大規模な変更のため、事前にGitコミットまたはバックアップを作成
- **段階的適用**: 一度に全て変更せず、段階ごとの確認を推奨
- **テスト実行**: リファクタリング後は必ずテストスイートの実行を確認
- **依存関係チェック**: 外部ライブラリとの互換性を事前に確認

$ARGUMENTS で対象パスを指定できます。引数がない場合は現在のディレクトリを対象とします。