# tidy-first

Kent BeckのTidyFirstメソドロジーに基づいて、コードの小さな整理作業を段階的に実行します。構造的変更と行動的変更を分離し、安全で漸進的なリファクタリングを実践します。

## プロセス:

1. **初期分析**
   - コードベースの現状把握
   - 潜在的な整理ポイントの特定
   - 既存テストの確認

2. **段階的計画**
   - 小さな整理作業（数時間以内）に分解
   - 構造的変更を優先順位付け
   - 各段階の検証方法を定義

3. **段階別実行**
   - 1つの整理作業に集中
   - テスト実行による動作確認
   - コミット単位での変更管理

4. **継続的検証**
   - 各段階完了後の品質確認
   - 次の整理ポイントの再評価
   - 必要に応じた計画調整

## 実行例:

**ステップ1: コード分析**
- 対象ファイル・ディレクトリの読み込み
- 複雑度とコード品質の評価
- 改善候補の優先度付け

**ステップ2: 整理計画**
- Guard句の導入箇所特定
- ヘルパー変数・関数の抽出候補
- 関連コードの近接化対象

**ステップ3: 構造的変更**
- 命名の改善（変数、関数、クラス）
- メソッド抽出・インライン化
- コードブロックの並び替え

**ステップ4: 動作検証**
- 全テストの実行
- 動作確認とベンチマーク
- 変更内容のレビュー

## 具体的なTidying技法:

### 即座に適用可能な技法
- **Guard句の使用**: 早期リターンで条件分岐を簡潔に
- **ヘルパー変数**: 複雑な式を意味のある変数に分割
- **関連コードの近接化**: 関係するコードを隣接配置
- **死んだコードの削除**: 使われていないコードの除去

### 慎重に適用する技法
- **メソッドの抽出**: 意味のある単位での関数化
- **変数の抽出**: 複雑な計算の中間結果を変数化
- **条件の統合**: 類似した条件文のまとめ
- **一時変数の除去**: 不要な一時変数の直接化

### 重要な原則
- **構造的変更と行動的変更を分離**: 絶対に混在させない
- **小さなステップ**: 各変更は数時間以内で完了
- **テストファースト**: 変更前後でテストを実行
- **コミット分割**: 1つの整理作業 = 1コミット

## エラーハンドリング:

- **テスト失敗時の対処**: 即座に変更を元に戻し、より小さなステップに分割
- **複雑すぎる変更の検出**: 作業時間が長すぎる場合は計画を再分割
- **依存関係エラー**: 他の部分への影響を最小限に抑制
- **マージコンフリクト**: 変更範囲を局所化して競合を回避

## Kent Beckの核心原則:

1. **人間関係の重視**: コードは人間が読むもの
2. **漸進的改善**: 大きな変更は小さなステップの積み重ね
3. **行動の分離**: 構造変更と機能変更は別々に
4. **経験的設計**: 実際の作業を通じて設計を洗練

## 使用例:
```bash
# 特定のファイルに対してTidyFirstを適用
claude /tidy-first src/main.js

# ディレクトリ全体を段階的に整理
claude /tidy-first src/

# 特定の技法に焦点を当てて整理
claude /tidy-first --focus=guard-clauses src/utils/

# テスト実行を含む完全なワークフロー
claude /tidy-first --with-tests src/components/
```